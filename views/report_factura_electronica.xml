<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="camaracomercio.factura_electronica_document">
            <t t-call="web.html_container">
                <t t-set="o" t-value="o.with_context(lang=lang)" />
                
                <div t-attf-class="header" t-att-style="report_header_style">
                    <div class="row">
                        <div class="col-3">
                            <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)" style="height: 100px;" alt="Logo"/>
                        </div>
                        <div class="col-5 text-center">
                            <small><div t-field="o.company_id.partner_id"
                                t-options='{"widget": "contact", "fields": ["address", "name", "phone", "email", "website"], "no_marker": true}'
                            /></small>
                        </div>
                        <div class="col-4 text-center">
                           <small>
                               <table style="width:100%">
                                   <tr>
                                       <td colspan="2" style="text-align: center; border: 1px solid white; border-radius: 7px; background-color: #92241c; color: white;"><b>Documento Tributario Electrónico<br/>
                                           <span t-if="o.move_type == 'out_invoice'">Invoice</span>
                                           <span t-if="o.move_type == 'out_refund'">Credit Note</span>
                                           <br/></b></td>
                                   </tr>
                                   <tr>
                                       <td style="text-align: left">Serie: <span t-field="o.serie_fel"/><br/></td>
                                       <td style="text-align: right">Número: <span t-field="o.numero_fel"/><br/></td>
                                   </tr>
                                   <tr>
                                       <td colspan="2" style="text-align: center">Fecha: <span t-field="o.invoice_date"/></td>
                                   </tr>
                               </table>
                            </small>
                        </div> 
                    </div>
                </div>
        
                <div class="page">
                    <table style="border: 1px solid black; border-radius: 7px;">
                        <tr style="font-size: smaller;">
                            <td style="width: 13%;"> Nombre: </td>
                            <td><span t-field="o.partner_id.name"/></td>
                            <td style="width: 7%;"> Nit: </td>
                            <td style="width: 17%;"><span t-field="o.partner_id.vat"/></td>
                        </tr>
                        <tr style="font-size: smaller;">
                            <td> Dirección: </td>
                            <td><span t-field="o.partner_id.contact_address"/></td>
                            <td> Código: </td>
                            <td><span t-field="o.partner_id.id"/></td>
                        </tr>
                        <tr style="font-size: smaller;">
                            <td> Forma de Pago: </td>
                            <td><span t-field="o.invoice_payment_term_id"/></td>
                            <td> Vendedor: </td>
                            <td><span t-field="o.invoice_user_id.name"/></td>
                       </tr>
                    </table><br/>
                    
                    <table style="border: 1px solid #92241c; border-radius: 7px; background-color: #92241c; color: white; width: 100%">
                        <tr style="font-size: smaller; text-align: center;">
                            <td style="width: 9%">Cantidad</td>
                            <td style="width: 65%">Descripción</td>
                            <td style="width: 13%">Precio Unitario</td>
                            <td style="text-align: center;width: 13%">Precio Total</td>
                        </tr>
                    </table>
                    
                    <div style="min-height: 17cm; border: 1px solid black; border-radius: 7px; width: 100%; position: relative;">
                        <table style="width: 100%">
                            <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                            <t t-foreach="lines" t-as="line">
                                <tr style="font-size: smaller;">
                                    <td style="width: 9%"><span t-field="line.quantity"/></td>
                                    <td style="width: 65%"><span t-field="line.name" t-options="{'widget': 'text'}"/></td>
                                    <td style="width: 13%"><span t-field="line.price_unit"/></td>
                                    <td style="width: 13%"><span class="text-nowrap" t-field="line.price_subtotal"/></td>
                                </tr>
                            </t>
                        </table>
                        <div style="position: absolute; bottom: 5px; width: 100%">
                            <table style="width: 100%">
                                <tr style="font-size: smaller;">
                                    <td style="text-align: right; width: 74%">Sub total:</td>
                                    <td style="text-align: right; width: 26%"><span t-field="o.amount_untaxed"/></td>
                                </tr>
                                <tr style="font-size: smaller;">
                                    <td style="text-align: right;">(-)Descuento 15%</td>
                                    <td style="text-align: right;"></td>
                                </tr>
                                <tr style="font-size: smaller;">
                                    <td style="text-align: right;">TP</td>
                                    <td style="text-align: right;"><span t-field="o.amount_tax"/></td>
                                </tr>
                                <tr style="font-size: smaller;">
                                    <td colspan="2" style="width: 9%"><span t-if="o.move_type == 'out_invoice'">Sujeto a pagos trimestrales ISR</span></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <div>
                        <table style="width: 100%">
                            <tr style="font-size: smaller;">
                                <td style="width: 74%">Total en Letras: <span t-esc="a_letras(o.amount_total)"/></td>
                                <td style="width: 13%; border: 1px solid #92241c; background-color: #92241c; color: white; border-radius: 7px 0px 0px 7px;"><b>Total</b></td>
                                <td style="text-align: right; width: 13%: border: 1px solid #92241c; background-color: #92241c; color: white; border-radius: 0px 7px 7px 0px;"><b><span t-field="o.amount_total"/></b></td>
                            </tr>
                        </table>
                    </div><br/>
                    
                    <div>
                        <small>
                            <b>Fecha de certificación:</b> <span t-field="o.invoice_date"/><br/>
                            <b>Número de autorización:</b> <span t-field="o.firma_fel"/> <br/>
                            <b>Certificador:</b> Cámara de Comercio de Guatemala <b>Nit:</b> 35159-8 <br/>
                            <b>Referencia interna:</b> <span t-field="o.payment_reference"/> <br/>
                            <b>Documento:</b> <span t-field="o.name"/> <br/>
                            Developed by solutioncenter.com.gt
                            <br/><br/><br/>
                            NO SE CONSIDERA CANCELADO ESTE DOCUMENTO SI NO ESTA AMPARADO CON EL RECIBO DE CAJA OFICIAL  DE LA ENTIDAD EXTENDIDO  POR EL CAJERO, COBRADOR O VENDEDOR.
                        </small>
                    </div>
                </div>
            </t>
        </template>

        <template id="camaracomercio.report_factura_electronica">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="lang" t-value="o.invoice_user_id.sudo().lang if o.move_type in ('in_invoice', 'in_refund') else o.partner_id.lang"/>
                    <t t-call="camaracomercio.factura_electronica_document" t-lang="lang"/>
                </t>
            </t>
        </template>
    </data>
</odoo>
